<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKM Masterclass ðŸŽ¬</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0b0b0b; color: #e0e0e0; text-align: center; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: #161616; padding: 25px; border-radius: 20px; border: 1px solid #333; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        h1 { color: #bb86fc; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 2px; }
        p.subtitle { color: #777; margin-bottom: 25px; font-size: 0.9em; }
        video { width: 100%; border-radius: 12px; border: 2px solid #bb86fc; background: black; margin-bottom: 15px; box-shadow: 0 0 15px rgba(187, 134, 252, 0.2); }
        .playlist { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; margin-top: 20px; }
        button { padding: 12px; cursor: pointer; background: #222; color: #aaa; border: 1px solid #444; border-radius: 8px; font-size: 14px; transition: 0.2s; height: 55px; }
        button:hover { background: #333; color: white; border-color: #bb86fc; }
        button.active { background: #bb86fc; color: #000; font-weight: bold; border-color: #fff; }
        #status { color: #bb86fc; font-weight: bold; margin-bottom: 10px; min-height: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>AKM Masterclass ðŸš€</h1>
        <p class="subtitle">Premium Production Training</p>
        
        <div id="status">Ready to Start</div>
        <video id="mainPlayer" controls controlsList="nodownload" oncontextmenu="return false;" crossorigin="anonymous">
            Your browser does not support the video tag.
        </video>

        <div class="playlist" id="playlist">
            </div>
    </div>

    <script>
        // --- YOUR CONFIGURATION ---
        const SB_URL = "https://rxhgxqubihuluemrqzmm.supabase.co";
        const SERVICE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4aGd4cXViaWh1bHVlbXJxem1tIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MTI5Mzg1MCwiZXhwIjoyMDg2ODY5ODUwfQ.SxozEE0m85pqJDvnMSTaF-5ZC2WqXgzQe107hc1Na-k";
        const BUCKET = "Videos"; 

        const lessons = {
            1: "INTRODUCTION", 2: "Chap 1", 3: "Chap 2", 4: "Chap 3-1", 
            5: "Chap 3-2", 6: "Chap 4", 7: "Pitch Warp", 8: "EQ", 
            9: "Deesser", 10: "Compression", 11: "Reverb EQ Explain", 
            12: "Delay", 13: "Saturation", 14: "Tone Balance", 15: "Mastering"
        };

        const player = document.getElementById('mainPlayer');
        const status = document.getElementById('status');
        const playlistDiv = document.getElementById('playlist');

        async function playVideo(num, btn) {
            const fileName = `${num}.mp4`;
            status.innerText = `â³ Loading: ${lessons[num]}...`;

            try {
                // Requesting a Signed URL
                const response = await fetch(`${SB_URL}/storage/v1/object/sign/${BUCKET}/${fileName}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${SERVICE_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ expiresIn: 3600 })
                });

                const data = await response.json();
                
                if (data.signedURL) {
                    // This is the fix: Ensure cross-origin is handled
                    player.crossOrigin = "anonymous";
                    player.src = SB_URL + data.signedURL;
                    player.play();
                    status.innerText = `ðŸ“º Now Playing: ${lessons[num]}`;
                    
                    document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                } else {
                    status.innerText = "âŒ Error: File not found!";
                    console.log("Supabase Error:", data);
                }
            } catch (err) {
                status.innerText = "âŒ Connection Error";
                console.error(err);
            }
        }

        Object.keys(lessons).forEach(num => {
            const btn = document.createElement('button');
            btn.innerHTML = `<b>${num}.</b><br>${lessons[num]}`;
            btn.onclick = () => playVideo(num, btn);
            playlistDiv.appendChild(btn);
        });
    </script>
</body>
</html>